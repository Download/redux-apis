{"version":3,"sources":["redux-apis.jsx"],"names":[],"mappings":"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","file":"redux-apis.js","sourcesContent":["// stolen from https://github.com/acdlite/redux-actions/blob/v0.9.0/src/createAction.js\r\nfunction createAction(type, actionCreator, metaCreator) {\r\n  const finalActionCreator = typeof actionCreator === 'function' ? actionCreator : (t) => t;\r\n  return (...args) => {\r\n    const action = {type, payload:finalActionCreator(...args)};\r\n    if (args.length === 1 && args[0] instanceof Error) {action.error = true;}\r\n    if (typeof metaCreator === 'function') {action.meta = metaCreator(...args);}\r\n    return action;\r\n  };\r\n}\r\n\r\nexport default class Api {\r\n\tconstructor(state) {\r\n\t\tObject.defineProperty(this, 'state', {\r\n\t\t\tget: function() {\r\n\t\t\t\tif (this.parent) {\r\n\t\t\t\t\tconst name = childName(this.parent, this);\r\n\t\t\t\t\treturn name ? this.parent.state && this.parent.state[name] : this.parent.state;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.store) {\r\n\t\t\t\t\tvar result = this.store.getState();\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\treturn state;\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\tif (!this.parent && !this.store) {\r\n\t\t\t\t\tstate = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.__handlers = {};\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.dispatch(this.createAction('@@redux-apis/INIT')());\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsub(name, api) {\r\n\t\tthis[name] = new api();\r\n\t\tthis[name].parent = this;\r\n\t}\r\n\r\n\tcreateAction(actionType, actionCreator, metaCreator) {\r\n\t\tlet name = childName(this.parent, this);\r\n\t\tif (name) {\r\n\t\t\treturn this.parent.createAction(name + '/' + actionType, actionCreator, metaCreator);\r\n\t\t}\r\n\t\treturn createAction(actionType, actionCreator, metaCreator);\r\n\t}\r\n\r\n\tdispatch(action) {\r\n\t\tif (this.parent) {return this.parent.dispatch(action);}\r\n\t\tif (this.store) {return this.store.dispatch(action);}\r\n\t\tif (typeof action == 'function') {return action(this.dispatch.bind(this), () => this.state);}\r\n\t\tthis.state = this.handle(action);\r\n\t\treturn action;\r\n\t}\r\n\r\n\tinitialState() {\r\n\t\treturn {};\r\n\t}\r\n\r\n\thandle(action) {\r\n\t\tconst idx = action.type.indexOf('/');\r\n\t\tconst sub = idx !== -1 && action.type.substring(0, idx);\r\n\t\tconst subs = Object.keys(this);\r\n\t\tlet result = typeof this.__handlers[action.type] == 'function'\r\n\t\t\t? this.__handlers[action.type].call(this, action)\r\n\t\t\t: this.state || this.initialState()\r\n\t\tif (result === this.state) {result = undefined;}\r\n\t\tfor (let i=0,key; key=subs[i]; i++) {\r\n\t\t\tif (key != 'parent' && this[key] instanceof Api) {\r\n\t\t\t\tlet act = key !== sub ? action : {...action, type:action.type.substring(idx + 1)};\r\n\t\t\t\tlet subState = this[key].handle(act);\r\n\t\t\t\tif (!this.state || this.state[key] !== subState) {\r\n\t\t\t\t\tresult ? result[key] = subState : result = {...this.state, [key]:subState};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result || this.state;\r\n\t}\r\n\r\n\taddHandler(actionType, handler) {\r\n\t\tthis.__handlers[actionType] = handler;\r\n\t}\r\n}\r\n\r\nexport class RootApi extends Api {\r\n\tconstructor(api, createStore, initialState) {\r\n\t\tsuper();\r\n\t\tthis.bind(api);\r\n\t\tlet reducer = (state, action) => {\r\n\t\t\treturn !this.store && state ? state : this.__api.handle(action);\r\n\t\t}\r\n\t\tthis.store = createStore(reducer, initialState);\r\n\t}\r\n\r\n\tbind(api) {\r\n\t\tif (this.__api) {\r\n\t\t\tapiKeys(this.__api).forEach((key) => delete this[key]);\r\n\t\t\tObject.keys(api).forEach((key) => delete RootApi[key]);\r\n\t\t}\r\n\t\tthis.__api = new api();\r\n\t\tapiKeys(this.__api).forEach((key) => {\r\n\t\t\tthis[key] = typeof this.__api[key] == 'function'\r\n\t\t\t\t? this.__api[key].bind(this.__api)\r\n\t\t\t\t: this.__api[key];\r\n\t\t});\r\n\t\tObject.keys(api).forEach((key) => RootApi[key] = api[key]);\r\n\t\tthis.__api.parent = this;\r\n\t}\r\n}\r\n\r\nvar RESERVED = Object.getOwnPropertyNames(Object.getPrototypeOf(new Api()))\r\n\t.concat(['parent', 'bind']);\r\n\r\nfunction childName(parent, child) {\r\n\tif (parent && (! (parent instanceof RootApi))) {\r\n\t\tconst siblings = Object.keys(parent);\r\n\t\tfor (let i=0,name; name=siblings[i]; i++) {\r\n\t\t\tif (parent[name] === child) {return name;}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction apiKeys(obj) {\r\n\treturn Object.getOwnPropertyNames(Object.getPrototypeOf(obj)).concat(Object.keys(obj))\r\n\t\t.filter(function(key){return RESERVED.indexOf(key) === -1;});\r\n}"],"sourceRoot":"/source/"}