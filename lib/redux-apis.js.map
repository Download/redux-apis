{"version":3,"sources":["redux-apis.jsx"],"names":[],"mappings":";;;;;;;;;QAuEgB,aAAa,GAAb,aAAa;QAMb,IAAI,GAAJ,IAAI;;;;;;;;IA3EC,GAAG;AACvB,UADoB,GAAG,CACX,KAAK,EAAE;wBADC,GAAG;;AAEtB,QAAM,CAAC,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE;AACpC,MAAG,EAAE,eAAW;AACf,QAAI,IAAI,CAAC,MAAM,EAAE;AAChB,SAAM,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;AAC1C,YAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;KAC/B;AACD,QAAI,IAAI,CAAC,KAAK,EAAE;AACf,YAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;KAC7B;AACD,WAAO,KAAK,CAAC;IACb;AACD,MAAG,EAAE,aAAS,KAAK,EAAE;AACpB,QAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;AAChC,UAAK,GAAG,KAAK,CAAC;KACd;IACD;GACD,CAAC,CAAC;EACH;;cAnBmB,GAAG;;sBAqBnB,IAAI,EAAE,GAAG,EAAE;AACd,OAAI,CAAC,IAAI,CAAC,GAAG,IAAI,GAAG,EAAE,CAAC;AACvB,OAAI,CAAC,IAAI,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC;GACzB;;;+BAEY,UAAU,EAAE,OAAO,EAAW;AAC1C,OAAM,IAAI,GAAG,IAAI,CAAC,MAAM,IAAI,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;;qCADrB,IAAI;AAAJ,QAAI;;;AAExC,OAAI,IAAI,EAAE;;;AACT,WAAO,WAAA,IAAI,CAAC,MAAM,EAAC,YAAY,MAAA,WAAC,IAAI,GAAG,GAAG,GAAG,UAAU,EAAE,OAAO,SAAK,IAAI,EAAC,CAAC;IAC3E,MAAM;AACN,WAAO,kBAjCD,YAAY,EAiCE,UAAU,CAAC,mBAAC,OAAO,SAAK,IAAI,EAAC,CAAC;IAClD;GACD;;;2BAEQ,MAAM,EAAE;AAChB,OAAI,IAAI,CAAC,MAAM,EAAE;AAChB,QAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC7B,MAAM,IAAI,IAAI,CAAC,KAAK,EAAE;AACtB,QAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC5B,MAAM;;AAEN,QAAI,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAClC;GACD;;;0BAEO,MAAM,EAAE;AACf,OAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACrC,OAAM,GAAG,GAAG,GAAG,KAAK,CAAC,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;AACxD,OAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC/B,OAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AACjC,OAAI,MAAM,KAAK,IAAI,CAAC,KAAK,EAAE;AAAC,UAAM,GAAG,SAAS,CAAC;IAAC;AAChD,QAAK,IAAI,CAAC,GAAC,CAAC,EAAC,GAAG,EAAE,GAAG,GAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;AACnC,QAAI,GAAG,IAAI,QAAQ,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,GAAG,EAAE;AAChD,SAAI,GAAG,GAAG,GAAG,KAAK,GAAG,GAAG,MAAM,gBAAQ,MAAM,IAAE,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,GAAE,CAAC;AACrF,SAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACtC,SAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,QAAQ,EAAE;AACjC,YAAM,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,QAAQ,GAAG,MAAM,gBAAQ,IAAI,CAAC,KAAK,sBAAG,GAAG,EAAG,QAAQ,EAAE,CAAC;MAC9E;KACD;IACD;AACD,UAAO,MAAM,IAAI,IAAI,CAAC,KAAK,CAAC;GAC5B;;;yBAEM,MAAM,EAAE;AACd,UAAO,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC;GACxB;;;QAlEmB,GAAG;;;kBAAH,GAAG;AAqEjB,SAAS,aAAa,CAAC,QAAQ,EAAE;AACvC,QAAO,UAAC,KAAK,EAAE,MAAM,EAAK;AACzB,SAAO,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;EAChC,CAAA;CACD;;AAEM,SAAS,IAAI,CAAC,QAAQ,EAAE,KAAK,EAAE;AACrC,SAAQ,CAAC,KAAK,GAAG,KAAK,CAAC;CACvB;;AAED,SAAS,SAAS,CAAC,MAAM,EAAE,KAAK,EAAE;AACjC,KAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AACrC,MAAK,IAAI,CAAC,GAAC,CAAC,EAAC,IAAI,EAAE,IAAI,GAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;AACzC,MAAI,MAAM,CAAC,IAAI,CAAC,KAAK,KAAK,EAAE;AAAC,UAAO,IAAI,CAAC;GAAC;EAC1C;CACD","file":"redux-apis.js","sourcesContent":["import { createAction } from 'redux-actions';\r\n\r\nexport default class Api {\r\n\tconstructor(state) {\r\n\t\tObject.defineProperty(this, 'state', {\r\n\t\t\tget: function() {\r\n\t\t\t\tif (this.parent) {\r\n\t\t\t\t\tconst name = childName(this.parent, this);\r\n\t\t\t\t\treturn this.parent.state[name];\r\n\t\t\t\t}\r\n\t\t\t\tif (this.store) {\r\n\t\t\t\t\treturn this.store.getState();\r\n\t\t\t\t}\r\n\t\t\t\treturn state;\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\tif (!this.parent && !this.store) {\r\n\t\t\t\t\tstate = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsub(name, api) {\r\n\t\tthis[name] = new api();\r\n\t\tthis[name].parent = this;\r\n\t}\r\n\r\n\tcreateAction(actionType, payload, ...args) {\r\n\t\tconst name = this.parent && childName(this.parent, this);\r\n\t\tif (name) {\r\n\t\t\treturn this.parent.createAction(name + '/' + actionType, payload, ...args);\r\n\t\t} else {\r\n\t\t\treturn createAction(actionType)(payload, ...args);\r\n\t\t}\r\n\t}\r\n\r\n\tdispatch(action) {\r\n\t\tif (this.parent) {\r\n\t\t\tthis.parent.dispatch(action);\r\n\t\t} else if (this.store) {\r\n\t\t\tthis.store.dispatch(action);\r\n\t\t} else {\r\n\t\t\t// root, but not connected to store, exec directly\r\n\t\t\tthis.state = this.execute(action);\r\n\t\t}\r\n\t}\r\n\r\n\texecute(action) {\r\n\t\tconst idx = action.type.indexOf('/');\r\n\t\tconst sub = idx !== -1 && action.type.substring(0, idx);\r\n\t\tconst subs = Object.keys(this);\r\n\t\tlet result = this.handle(action);\r\n\t\tif (result === this.state) {result = undefined;}\r\n\t\tfor (let i=0,key; key=subs[i]; i++) {\r\n\t\t\tif (key != 'parent' && this[key] instanceof Api) {\r\n\t\t\t\tlet act = key !== sub ? action : { ...action, type: action.type.substring(idx + 1) };\r\n\t\t\t\tlet subState = this[key].execute(act);\r\n\t\t\t\tif (this.state[key] !== subState) {\r\n\t\t\t\t\tresult ? result[key] = subState : result = { ...this.state, [key]: subState };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result || this.state;\r\n\t}\r\n\r\n\thandle(action) {\r\n\t\treturn this.state || {};\r\n\t}\r\n}\r\n\r\nexport function createReducer(instance) {\r\n\treturn (state, action) => {\r\n\t\treturn instance.execute(action);\r\n\t}\r\n}\r\n\r\nexport function bind(instance, store) {\r\n\tinstance.store = store;\r\n}\r\n\r\nfunction childName(parent, child) {\r\n\tconst siblings = Object.keys(parent);\r\n\tfor (let i=0,name; name=siblings[i]; i++) {\r\n\t\tif (parent[name] === child) {return name;}\r\n\t}\r\n}\r\n\r\n"],"sourceRoot":"/source/"}